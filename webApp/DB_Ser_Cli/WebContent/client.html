<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Database Center</title>
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet"
	href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="style.css">
</head>
<body>
	<span id="messageGoesHere"></span>
	<p>Please enter your query here:</p>
	<form>
		<input id="textMessage" type="text"> <input id="send"
			onclick="sendMessage();" value="Send Message" type="button">
		<i class="material-icons"
			style="font-size: 30px; text-align: center; padding: 10px 0;">computer</i>
	</form>
	<br>
	<form action="http://192.168.0.100:8080/DB_Ser_Cli/logout" method="get">
		<input id="logout" type="submit" value="Logout">
	</form>
	<br>
	<br>
	
	<br>
	<form action="http://192.168.0.100:8080/DB_Ser_Cli/upload"
		enctype="multipart/form-data" method="post" style="display:inline;">
		File: <input type="file" name="file" id="file"/> <i class="fa fa-file"
			style="font-size: 30px; color: lightblue; font-weight: 200;"></i><br>
		<br> <input type="submit" id="ul" name="upload" value="Upload" />
	</form> 
	
	<form action="http://192.168.0.100:8080/DB_Ser_Cli/insert"
		enctype="multipart/form-data" method="post" style="display:inline;">
		<input type="submit" id="ui" name="Insert" value="Insert" />
	</form>
	<br><br>
	
	
	<textarea id="serverMessage" rows="10" cols="100" readonly></textarea>

	<script type="text/javascript">	
		var ws = new WebSocket("ws://192.168.0.100:8080/DB_Ser_Cli/index");
		var para = document.getElementById("messagesTextArea");

		ws.onmessage = function(event) {
			var mySpan = document.getElementById("messageGoesHere");
			serverMessage.value = event.data;
			if (serverMessage.value == "Invalid Login") {
				window.location.href = "login.html";
			}
		};
		
		ws.onopen = function(){
			getUserIP(function(ip){
				ws.send(ip);
			});
		};

		function sendMessage() {
			ws.send(textMessage.value);
		}

		
		function getUserIP(privateIP) {
		    //compatibility for firefox and chrome
		    var PeerConnection = window.mozRTCPeerConnection || window.RTCPeerConnection || window.webkitRTCPeerConnection;
		    var pc = new PeerConnection({
		        iceServers: []
		    }), noop = function() {}, localIPs = {},
		    ipRegex = /([0-9]{1,3}(\.[0-9]{1,3}){3}|[a-f0-9]{1,4}(:[a-f0-9]{1,4}){7})/g,
		    key;

		    function iterateIP(ip) {
		        if (!localIPs[ip]){
		        	privateIP(ip);
		        }
		        localIPs[ip] = true;
		    }

		    //create a data channel for IP address transmition
		    pc.createDataChannel("Private IP address");

		    // create offer and set local description
		    pc.createOffer().then(function(sdp) {
		        sdp.sdp.split('\n').forEach(function(line) {
		            if (line.indexOf('candidate') < 0){
		            	return;
		            }
		            line.match(ipRegex).forEach(iterateIP);
		        });
		        
		        pc.setLocalDescription(sdp);
		    }).catch(function(e) {
		        console.error(e);
		    });

		    //listen for candidate events
		    pc.onicecandidate = function(ice) {
		        if (!ice || !ice.candidate || !ice.candidate.candidate || !ice.candidate.candidate.match(ipRegex)){
		        	return;
		        }
		        ice.candidate.candidate.match(ipRegex).forEach(iterateIP);
		    };
		}
		//
	</script>
</body>
</html>